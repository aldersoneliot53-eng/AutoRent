<!-- cliente/reservas.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mis Reservas | AutoRent S.A.C.</title>
  <link rel="stylesheet" href="../assets/css/normalize.css" />
  <link rel="stylesheet" href="../assets/css/main.css" />
  <link rel="stylesheet" href="../assets/css/cliente.css" />
</head>
<body>
  <div id="header-placeholder"></div>

  <main class="main-cliente">
    <h1>Mis Reservas</h1>
    <p id="no-reservas" style="display: none;">No tienes reservas aún. <a href="../public/flota.html">Haz tu primera reserva</a>.</p>
    
    <div id="reservas-list" class="reservas-container">
      <!-- Las reservas se cargarán aquí con JavaScript -->
    </div>
  </main>

  <div id="footer-placeholder"></div>

  <script src="../assets/js/app.js" defer></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const usuario = JSON.parse(localStorage.getItem("usuarioActivo"));
      if (!usuario) {
        window.location.href = "../auth/login.html";
        return;
      }

      const reservas = JSON.parse(localStorage.getItem("reservas")) || [];
      const misReservas = reservas.filter(r => r.email === usuario.email);

      const lista = document.getElementById("reservas-list");
      const noReservas = document.getElementById("no-reservas");

      if (misReservas.length === 0) {
        noReservas.style.display = "block";
        lista.innerHTML = "";
        return;
      }

      // Ordenar por ID descendente (más reciente primero)
      misReservas.sort((a, b) => b.id - a.id);

      lista.innerHTML = `
        <table class="reservas-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Auto</th>
              <th>Fechas</th>
              <th>Total</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            ${misReservas.map(r => `
              <tr>
                <td>${r.id}</td>
                <td>${r.auto || "Toyota Corolla"}</td>
                <td>${r.fechaInicio} - ${r.fechaFin}</td>
                <td>S/ ${r.total || "0"}</td>
                <td><span class="status ${r.estado?.toLowerCase() || 'pending'}">${r.estado || 'Pendiente'}</span></td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    });
  </script>
</body>
</html>